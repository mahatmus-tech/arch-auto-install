---
- name: Install user applications
  pacman:
    name:
      - emacs
      - micro
    state: present

- name: Install flatpak applications
  flatpak:
    name:
      - dev.vencord.Vesktop
      - com.freerdp.FreeRDP
    state: present

- name: Install AUR applications
  shell: yay -S --noconfirm brave-bin teams-for-linux
  args:
    executable: /bin/bash

#- name: Configure Brave for Wayland
#  lineinfile:
#    path: /usr/share/applications/brave-browser.desktop
#    regexp: '^Exec='
#    line: 'Exec=brave-browser --enable-features=UseOzonePlatform --ozone-platform=wayland %U'
#    backup: yes

- name: Create 120hz monitor config
  copy:
    dest: /home/mahatmus/.config/hypr/Monitor_Profiles/120hz.conf
    content: |
      # Generated by nwg-displays on 2025-03-24 at 12:02:36. Do not edit manually.
      
      # Não está na wiki, mas para ser o monitor primário ele deve ter a posição 0x0
      # também deixar o monitor primário acima do secundário

      monitor=HDMI-A-1,0x0@60.0,-1x-1,1.0
      monitor=HDMI-A-1,disable
      monitor=DP-3,modeline 336.96 1920 1968 2000 2080 1080 1083 1088 1350 +hsync -vsync, 0x0, 1.0, bitdepth, 8, cm, srgb
      monitor=DP-1,2560x1080@60.0, -2560x0, 1.0
    owner: mahatmus
    group: mahatmus
    mode: '0644'

- name: Configure startup apps
  block:
    - name: Check if Startup_Apps.conf exists
      stat:
        path: /home/mahatmus/.config/hypr/UserConfigs/Startup_Apps.conf
      register: startup_conf

    - name: Append new exec-once commands to existing file
      ansible.builtin.blockinfile:
        path: /home/mahatmus/.config/hypr/UserConfigs/Startup_Apps.conf
        insertafter: '(^exec-once.*|^$)'
        block: |
          exec-once = emacs --daemon &
          exec-once = systemctl --user start gamemoded.service
        owner: mahatmus
        group: mahatmus
        mode: '0644'
      when: startup_conf.stat.exists and startup_conf.stat.size > 0

# make it later
#- name: Configure environment variablesk